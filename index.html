<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D ç…§ç‰‡è§€è³å™¨ - æ™ºèƒ½å°ç„¦ç‰ˆ</title>
    <style>
        /* æˆ‘åªè£œå……ä½ åŸæœ¬ CSS ä¸­æ¼æ‰æˆ–éœ€è¦å¾®èª¿çš„éƒ¨åˆ† */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        :root { --primary: #6366f1; --primary-dark: #4f46e5; --accent: #f59e0b; --success: #10b981; --bg: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%); --card-bg: rgba(26, 26, 46, 0.8); --text: #f0f0f0; --text-dim: #a0a0b0; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-x: hidden; }
        .header { text-align: center; margin-bottom: 30px; }
        .viewport { position: relative; width: 100%; max-width: 700px; perspective: 1500px; }
        .photo-container { position: relative; width: 100%; aspect-ratio: 16/9; border-radius: 24px; overflow: hidden; background: #000; box-shadow: 0 50px 100px rgba(0,0,0,0.5); transform-style: preserve-3d; }
        canvas { display: block; width: 100%; height: 100%; object-fit: cover; }
        #canvasL, #canvasR { position: absolute; top: 0; left: 0; width: 100%; height: 100%; will-change: transform, opacity; }
        .controls { width: 100%; max-width: 700px; background: var(--card-bg); backdrop-filter: blur(20px); border-radius: 24px; padding: 28px; border: 1px solid rgba(255,255,255,0.1); }
        .mode-tabs { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; background: rgba(0,0,0,0.3); padding: 6px; border-radius: 16px; margin-bottom: 20px; }
        .mode-tab { padding: 16px; border-radius: 12px; cursor: pointer; text-align: center; color: var(--text-dim); transition: 0.3s; }
        .mode-tab.active { background: var(--primary); color: white; }
        .upload-zone { border: 2px dashed rgba(255,255,255,0.2); border-radius: 16px; padding: 30px; text-align: center; cursor: pointer; }
        .thumb-nav { display: flex; gap: 12px; overflow-x: auto; padding: 10px 0; }
        .thumb-item { flex: 0 0 80px; height: 80px; border-radius: 12px; border: 3px solid rgba(255,255,255,0.2); overflow: hidden; cursor: pointer; }
        .thumb-item.active { border-color: var(--accent); transform: scale(1.05); }
        .thumb-item img { width: 100%; height: 100%; object-fit: cover; }
        .gyro-btn { width: 100%; padding: 16px; border-radius: 14px; background: rgba(255,255,255,0.05); color: white; cursor: pointer; margin: 20px 0; border: 1px solid rgba(255,255,255,0.1); }
        .gyro-btn.active { background: var(--success); }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">ğŸ¨</div>
        <h1>3D ç…§ç‰‡è§€è³å™¨</h1>
        <p class="subtitle">æ™ºèƒ½å°ç„¦å„ªåŒ–ç‰ˆ</p>
    </div>

    <div class="viewport" id="vbox">
        <div class="photo-container" id="photoContainer">
            <canvas id="canvasSingle" style="display:none;"></canvas>
            <canvas id="canvasL" style="display:none;"></canvas>
            <canvas id="canvasR" style="display:none;"></canvas>
        </div>
    </div>

    <div class="controls">
        <div class="mode-tabs">
            <div class="mode-tab" id="tabSingle">ğŸ“¸ å–®åœ–æ·±åº¦</div>
            <div class="mode-tab active" id="tabStereo">ğŸ‘ï¸ ç«‹é«”è¦–å·®</div>
        </div>

        <div id="singleContent" style="display:none;">
            <label class="upload-zone">
                <div style="font-size:40px">ğŸ“¤</div>
                <div style="font-weight:700">ä¸Šå‚³å–®å¼µç…§ç‰‡</div>
                <input type="file" id="singleUpload" accept="image/*">
            </label>
        </div>
        
        <div id="stereoContent">
            <div class="thumb-nav" id="thumbNav"></div>
        </div>

        <button class="gyro-btn" id="authBtn">é–‹å•Ÿé™€èºå„€ 3D æ¨¡å¼</button>
    </div>

    <script>
        const cvSingle = document.getElementById('canvasSingle');
        const cvL = document.getElementById('canvasL');
        const cvR = document.getElementById('canvasR');
        const ctxS = cvSingle.getContext('2d');
        const ctxL = cvL.getContext('2d');
        const ctxR = cvR.getContext('2d');
        const pc = document.getElementById('photoContainer');
        const thumbNav = document.getElementById('thumbNav');
        
        let currentMode = 'Stereo';
        let singleImg = null;
        let stereoImages = [];
        let targetX = 0.5, targetY = 0.5;
        let curX = 0.5, curY = 0.5;

        // é è¨­ç…§ç‰‡
        const stereoFilenames = ['photo1.jpg', 'photo2.jpg', 'photo3.jpg', 'photo4.jpg'];

        // 1. åˆå§‹åŒ–å°è¦½åˆ—
        window.onload = () => {
            stereoFilenames.forEach((name, i) => {
                const img = new Image();
                img.src = name;
                img.onload = () => {
                    stereoImages[i] = img;
                    const div = document.createElement('div');
                    div.className = 'thumb-item' + (i === 0 ? ' active' : '');
                    div.innerHTML = `<img src="${name}">`;
                    div.onclick = () => loadStereo(i);
                    thumbNav.appendChild(div);
                    if (i === 0) loadStereo(0);
                };
            });
            requestAnimationFrame(animate);
        };

        // 2. æ¨¡å¼åˆ‡æ›
        document.getElementById('tabSingle').onclick = () => switchMode('Single');
        document.getElementById('tabStereo').onclick = () => switchMode('Stereo');

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('tabSingle').classList.toggle('active', mode === 'Single');
            document.getElementById('tabStereo').classList.toggle('active', mode === 'Stereo');
            document.getElementById('singleContent').style.display = mode === 'Single' ? 'block' : 'none';
            document.getElementById('stereoContent').style.display = mode === 'Stereo' ? 'block' : 'none';
            
            cvSingle.style.display = (mode === 'Single') ? 'block' : 'none';
            cvL.style.display = cvR.style.display = (mode === 'Stereo') ? 'block' : 'none';
        }

        // 3. æ ¸å¿ƒæ¸²æŸ“é‚è¼¯
        function render() {
            const mx = (curX - 0.5);
            const my = (curY - 0.5);

            if (currentMode === 'Single' && singleImg) {
                ctxS.clearRect(0,0,cvSingle.width, cvSingle.height);
                // å–®åœ–ï¼šèƒŒæ™¯ç¨å¾®ä½ç§»
                ctxS.drawImage(singleImg, -30 + mx*60, -30 + my*60, cvSingle.width+60, cvSingle.height+60);
                pc.style.transform = `rotateX(${-my*20}deg) rotateY(${mx*20}deg) scale(1.05)`;
            } 
            else if (currentMode === 'Stereo') {
                // --- ä¿®æ­£æ¨¡ç³Šä½ç½® ---
                // ç•¶ mx (ä½ç§») å¢åŠ æ™‚ï¼Œæˆ‘å€‘å¸Œæœ›ã€ŒèƒŒæ™¯ã€æ¨¡ç³Šã€‚
                // é€™è£¡æˆ‘å€‘å‡è¨­å·¦å³çœ¼é‡åˆè™•ï¼ˆmx=0ï¼‰æ˜¯ä¸»é«”ã€‚
                const blurVal = Math.abs(mx) * 2; // ä½ç§»è¶Šå¤§è¶Šæ¨¡ç³Š
                
                // è¨­å®šç•«å¸ƒæ¿¾é¡ï¼šè®“å…©å¼µåœ–åœ¨æ™ƒå‹•æ™‚ç”¢ç”Ÿè¼•å¾®æ™¯æ·±æ„Ÿ
                // é€šå¸¸å¾Œæ–¹çš„åœ–å±¤ (CanvasL) ä½ç§»æ„Ÿæœƒèˆ‡ CanvasR å½¢æˆè¦–å·®
                cvL.style.filter = `blur(${blurVal * 0.5}px)`; 
                cvR.style.filter = `blur(${blurVal}px)`; 

                // è¦–å·®ä½ç§»èˆ‡é€æ˜åº¦ (S-Curve)
                const drift = mx * 30;
                cvL.style.transform = `scale(1.1) translateX(${-drift * 0.5}px)`;
                cvR.style.transform = `scale(1.1) translateX(${drift * 0.5}px)`;
                
                const opacityR = 0.4 + (curX * 0.6);
                cvR.style.opacity = opacityR;
                cvL.style.opacity = 1.4 - opacityR;

                pc.style.transform = `rotateX(${-my*15}deg) rotateY(${mx*15}deg) scale(1.02)`;
            }
        }

        // 4. å‹•ç•«èˆ‡äº’å‹• (ä¿æŒæµæš¢)
        function animate() {
            curX += (targetX - curX) * 0.1;
            curY += (targetY - curY) * 0.1;
            render();
            requestAnimationFrame(animate);
        }

        function loadStereo(idx) {
            const img = stereoImages[idx];
            if(!img) return;
            const w = img.width/2; const h = img.height;
            cvL.width = cvR.width = w; cvL.height = cvR.height = h;
            ctxL.drawImage(img, 0, 0, w, h, 0, 0, w, h);
            ctxR.drawImage(img, w, 0, w, h, 0, 0, w, h);
            pc.style.aspectRatio = `${w}/${h}`;
            document.querySelectorAll('.thumb-item').forEach((t, i) => t.classList.toggle('active', i === idx));
        }

        document.getElementById('singleUpload').onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    singleImg = img;
                    cvSingle.width = 800; cvSingle.height = 800 * (img.height/img.width);
                    pc.style.aspectRatio = `${img.width}/${img.height}`;
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        };

        // æ»‘é¼ èˆ‡é™€èºå„€
        document.getElementById('vbox').onmousemove = (e) => {
            const r = e.currentTarget.getBoundingClientRect();
            targetX = (e.clientX - r.left) / r.width;
            targetY = (e.clientY - r.top) / r.height;
        };
        document.getElementById('vbox').onmouseleave = () => { targetX = targetY = 0.5; };
    </script>
</body>
</html>
